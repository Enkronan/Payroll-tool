{% extends "layout_no_container.html" %}

{% block title %}
    Log In
{% endblock %}

{% block main %}

<div class="container p-5">
            
        
        <div class="titlebar-container">
            <div class="titlebar">
                <h1 class="title">{{ company.company_name }}</h1>
            </div>
        </div>
        <div id="add-employee-button">
            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal">Add Employee</button>
        </div>
        <table class="table table-striped table-dark">
            <thead>
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">First Name</th>
                    <th scope="col">Last Name</th>
                    <th scope="col">Person Nummer</th>
                </tr>
            </thead>
            <tbody>
                {% for item in employees.items %}
                    <tr> 
                        <th scope="row">{{ item.id }}</th>
                        <td>{{ item.first_name }}</td>
                        <td>{{ item.last_name }}</td>
                        <td>{{ item.person_nummer }}</td>
                        <td><button type="button" class="btn btn-primary" onclick="editEmployee('{{ url_for('main.editEmployeeForm', employee_id=item.id) }}')">Edit Employee</button></td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
        {% for page_num in employees.iter_pages(left_edge=1, right_edge=1, left_current=1, right_current=2) %}
        {% if page_num %}
            {% if employees.page == page_num %}
                <a class="btn btn-info mb-4" href= "{{ url_for('main.employee', page=page_num) }}">{{ page_num }}</a>
            {% else %}
                <a class="btn btn-outline-info mb-4" href= "{{ url_for('main.employee', page=page_num) }}">{{ page_num }}</a>
            {% endif %}     
        {% else %}

        {% endif %}
        {% endfor %}
</div>
    

<div class="modal fade bd-example-modal-xl" data-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="myExtraLargeModalLabel" aria-hidden="true" id="myModal">
        <div class="modal-dialog modal-xl" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="staticBackdropLabel">Add Employee!</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
            <div class="form-group">
                <form action="{{ url_for('main.employeeForm') }}" method="post" id="editForm">
                    {{ form.hidden_tag() }}
                    <fieldset class="form-group">
                        <div class="form-group">
                            {{ form.first_name.label(class="form-control-label") }}
                            {% if form.first_name.errors %}
                                {{ form.first_name(class="form-control form-control-lg is-invalid") }}    
                                <div class="invalid-feedback">
                                    {% for error in form.first_name.errors %}
                                        <span>{{ error }} </span>
                                    {% endfor %}
                                </div>
                            {% else %}
                                {{ form.first_name(class="form-control form-control-lg") }}
                            {% endif %}                      
                        </div>
                        <div class="form-group">
                            {{ form.last_name.label(class="form-control-label") }}
                            {% if form.last_name.errors %}
                                {{ form.last_name(class="form-control form-control-lg is-invalid") }}    
                                <div class="invalid-feedback">
                                    {% for error in form.last_name.errors %}
                                        <span>{{ error }} </span>
                                    {% endfor %}
                                </div>
                            {% else %}
                                {{ form.last_name(class="form-control form-control-lg") }}
                            {% endif %}  
                        </div>
                        <div class="form-group">
                            {{ form.person_nummer.label(class="form-control-label") }}
                            {% if form.person_nummer.errors %}
                                {{ form.person_nummer(class="form-control form-control-lg is-invalid") }}    
                                <div class="invalid-feedback">
                                    {% for error in form.person_nummer.errors %}
                                        <span>{{ error }} </span>
                                    {% endfor %}
                                </div>
                            {% else %}
                                {{ form.person_nummer(class="form-control form-control-lg") }}
                            {% endif %}  
                        </div>
                        <div class="form-group">
                            {{ form.skattetabell.label(class="form-control-label") }}
                            {% if form.skattetabell.errors %}
                                {{ form.skattetabell(class="form-control form-control-lg is-invalid") }}    
                                <div class="invalid-feedback">
                                    {% for error in form.skattetabell.errors %}
                                        <span>{{ error }} </span>
                                    {% endfor %}
                                </div>
                            {% else %}
                                {{ form.skattetabell(class="form-control form-control-lg") }}
                            {% endif %}  
                        </div>
                        <div class="form-group">
                            {{ form.expat_type.label(class="form-control-label") }}
                            {% if form.expat_type.errors %}
                                {{ form.expat_type(class="form-control form-control-lg is-invalid") }}    
                                <div class="invalid-feedback">
                                    {% for error in form.expat_type.errors %}
                                        <span>{{ error }} </span>
                                    {% endfor %}
                                </div>
                            {% else %}
                                {{ form.expat_type(class="form-control form-control-lg") }}
                            {% endif %}  
                        </div>
                        <div class="form-group">
                            {{ form.assign_start.label(class="form-control-label") }}
                            {% if form.assign_start.errors %}
                                {{ form.assign_start(class="form-control form-control-lg is-invalid") }}    
                                <div class="invalid-feedback">
                                    {% for error in form.assign_start.errors %}
                                        <span>{{ error }} </span>
                                    {% endfor %}
                                </div>
                            {% else %}
                                {{ form.assign_start(class="form-control form-control-lg") }}
                            {% endif %}  
                        </div>
                        <div class="form-group">
                            {{ form.assign_end.label(class="form-control-label") }}
                            {% if form.assign_end.errors %}
                                {{ form.assign_end(class="form-control form-control-lg is-invalid") }}    
                                <div class="invalid-feedback">
                                    {% for error in form.assign_end.errors %}
                                        <span>{{ error }} </span>
                                    {% endfor %}
                                </div>
                            {% else %}
                                {{ form.assign_end(class="form-control form-control-lg") }}
                            {% endif %}  
                        </div>
                        <div class="form-check">
                            {{ form.expert(class="form-check-input") }}
                            {{ form.expert.label(class="form-check-label") }}
                        </div>
                        <div class="form-check">
                            {{ form.sink(class="form-check-input") }}
                            {{ form.sink.label(class="form-check-label") }}
                        </div>
                        <div class="form-check">
                            {{ form.six_month_rule(class="form-check-input") }}
                            {{ form.six_month_rule.label(class="form-check-label") }}
                        </div>
                        <div class="form-group">
                            {{ form.social_security.label(class="form-control-label") }}
                            {% if form.social_security.errors %}
                                {{ form.social_security(class="form-control form-control-lg is-invalid") }}    
                                <div class="invalid-feedback">
                                    {% for error in form.social_security.errors %}
                                        <span>{{ error }} </span>
                                    {% endfor %}
                                </div>
                            {% else %}
                                {{ form.social_security(class="form-control form-control-lg") }}
                            {% endif %}  
                        </div>
                    </fieldset>
                    <div class="form-group">
                        {{ form.submit(class="btn btn-outline-info", id="uform")}}
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>


<script>
$('#uform').click(function(event) {
    event.preventDefault();
    var url = "{{ url_for('main.employeeForm') }}"
    $.post(url, data=$('#editForm').serialize(), function(data) {
      if (data.status == 'ok') {
        $('#myModal').modal('hide');
        location.reload();
      }
      else {
        $('#myModal .modal-content').html(data);
      }
    });
})

function editEmployee(url){
      $.get(url, function(data) {
        $('#myModal .modal-content').html(data);
        $('#myModal').modal();
      });
    }
      


</script>

{% endblock %}